## 5.2.2 트랜잭션 경계설정

DB는 그 자체로 완벽한 트랜잭션을 지원한다. 그러나 때때로 여러개의 쿼리가 하나의 트랜잭션으로 이루어져야 할 때가 있다. 예를 들면 계좌이체

### JDBC 트랜잭션의 트랜잭션 경계설정

- 트랜잭션 경계설정(transaction demarcation) : `setAutoCommit(false)`로 트랜잭션의 시작을 선언하고 `commit()` 또는 `rollback()` 으로 트랜잭션을 종료하는 작업


DAO메소드에서 DB 커넥션을 매번 만들기 때문에 비즈니스 로직을 담고 있는 UserService 내에서 진행되는 여러 가지 작업을 하나의 트랜잭션으로 묶는 일이 불가능해진다.
그렇다면 어덯게 하면 여러 번 DB 에 업데이트해야 하는 작업을 하나의 트랜잭션으로 만들 수 있을까?

### 비즈니스 로직 내의 트랜잭션 경계설정

결국 트랜잭션의 경계 설정 작업을 UserService 쪽으로 가져와야 한다. 그럼 UserService에서 Connection 오브젝트를 만들어 UserDao에서 사용하도록 해야한다. 이런 경우에 문제점이 있다.

1. DB 커넥션을 비롯한 리소스의 처리를 가능하게 했던 JdbcTemplate을 더 이상 사용할 수 없다.
2. 더이상 액세스 기술에 독립적일 수 없다.
3. 테스트코드에도 영향을 미친다. (테스트 코드에서 직접 Connection 오브젝트를 일일이 만들어서 DAO 메소드를 호출하도록 변경해야 한다.)


## 5.2.3 트랜잭션 동기화

스프링은 트랜잭션 동기화 기능을 지원하는 간단한 유틸리티 메소드를 제공하고 있다.

스프링이 제공하는 트랜잭션 동기화 관리 클래스는 TransactionSynchronizationManager다.. 이 클래스를 이용해 트랜잭션 동기화 작업을 초기화 / 트랜잭션 작업 시작 / 트랜잭션 커밋 / 커넥션 닫기 / 동기화 요청을 할수 있다.

JDBC의 트랜잭션 경계설정 메소드를 사용해 트랜잭션을 이용하는 전형적인 코드에 간단한 트랜잭션 동기화를 적용해봤다. 

## 5.2.4 트랜잭션 서비스 추상화

스프링은 트랜잭션 기술의 공통점을 담은 트랜잭션 추상화 기술을 제공하고 있다. 스프링이 제공하는 트랜잭션 추상화 방법을 UserService에 적용해보자. PlatformTransactionManager fmf tkdydgkaus ehlsek. 